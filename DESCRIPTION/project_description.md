Product Requirements Document: Agent Dynamic Web InterfaceVersion: 2.2 (Adopts OpenAPI Spec & Identifier Trust Auth Strategy)Date: April 19, 20251. Introduction / OverviewThis document describes the requirements for a software project designed to enable Large Language Model (LLM) agents to interact with human users through dynamically generated web interfaces. The system will allow agents to specify UI views (like forms, chat interfaces, dashboards) by providing configuration data, which will be instantiated and rendered as objects within a Streamlit frontend. The primary interaction model involves users accessing specific tasks, often via unique links containing a task_id, where an LLM agent assists in completing the task after validating user access.2. GoalsEnable LLM agents to communicate and interact effectively with human users via dynamic, simple web UIs, often within the context of specific tasks.Provide a flexible mechanism for agents to request specific user input (via form views) and display information (via dashboard or chat views) relevant to a task.Ensure secure user access to the application using standard identity providers (Google, Microsoft) and implement task-based authorization on the backend.Establish a reusable, object-oriented framework for building agent-human web interactions within Streamlit, with a clearly defined API contract.3. User Personas / AudienceEnd User: Interacts with the Streamlit web interface to collaborate with an LLM agent, provide input, and view results or ongoing processes, often by navigating to a link for a specific task. Requires a clear and responsive UI rendered from view objects and appropriate access control messages.Agent Developer (Implicit): Designs and implements the LLM agent logic, including defining the requirements for the dynamic UI by generating configuration data for specific UI view classes, potentially varying based on the task_id. Requires a well-defined configuration format and understanding of the interaction flow defined by the API contract.Frontend Developer (Implicit): Defines and implements the reusable UI View Classes within the Streamlit application that interpret configuration data and render the UI. Implements frontend logic according to the API contract.Backend Developer (Implicit): Implements the Agent Logic Server according to the API contract, including task access validation logic.4. Functional RequirementsFR1: User Authentication & Task AccessFR1.1: Users must be able to initiate a login flow using their Google account via OIDC.FR1.2: Users must be able to initiate a login flow using their Microsoft account (Azure AD/Entra ID or Personal MSA) via OIDC.FR1.3: Users must be able to log out of the application.FR1.4: The system must securely identify the logged-in user (user_id, e.g., email) after successful OIDC authentication.FR1.5: The system must handle incoming URL query parameters, specifically task_id, to identify task-specific interaction requests (e.g., https://your-app.com/?task_id=XYZ).FR1.6: If a user accesses a URL with a task_id parameter but is not logged in, the system must present the login page first, and upon successful login, proceed to check task access (FR2.1, FR4.2).FR2: Dynamic UI Rendering (Streamlit Frontend)FR2.1: Upon successful user login or session initiation, the Streamlit frontend must check for a task_id in the URL query parameters (using st.query_params). It must then request the initial UI view configuration from the Agent Logic server via the defined API, passing the authenticated user_id and the task_id (if present).FR2.2: The Streamlit frontend must parse the API response, checking for status (e.g., success, access_denied, error) and extracting the UI view configuration data structure (likely JSON) if successful.FR2.3: If access is granted (status: success), the Streamlit frontend must dynamically instantiate the appropriate UI View Class based on the configuration and call its render method to display the UI. Initial supported views include simple text/markdown display, forms, chat messages, and basic metrics/dashboard elements.FR2.4: The UI view configuration format will be versioned (starting V1.0) and defined as part of the API contract.FR2.5: If the API response indicates access is denied (status: access_denied), the Streamlit frontend must display a clear 'Access Denied' message to the user instead of rendering the agent's UI view.FR3: User-Agent Interaction (Streamlit Frontend)FR3.1: The Streamlit frontend must detect user interactions with rendered UI elements.FR3.2: The system must use unique key attributes (defined within the view configuration) to identify which element was interacted with.FR3.3: The Streamlit frontend must collect relevant data associated with the interaction.FR3.4: The Streamlit frontend must package the interaction details according to the API contract (including action_key, data, user_id, and current task_id if applicable).FR3.5: The Streamlit frontend must send these packaged details via a secure API call to the Agent Logic server's interaction endpoint.FR4: Agent Logic Processing (Backend Server)FR4.1: The Agent Logic server must expose a secure API endpoint (e.g., /interact) defined by the OpenAPI specification, accepting parameters including the user_id and an optional task_id.FR4.2: The Agent Logic server must validate the received user_id (trusted from the Streamlit backend for MVP, see Sec 6) and verify if this user_id has the necessary permissions to access the requested task_id (if provided).FR4.3: If access is validated (or if no task_id was required), the Agent Logic server must process the received action_key and data according to the specific agent's logic and current state (potentially scoped to the task_id).FR4.4: The Agent Logic server must interact with a separate Agent Memory service as needed.FR4.5: Based on the outcome, the Agent Logic server must generate either the appropriate next UI view configuration data or an indication that access is denied.FR4.6: The Agent Logic server must return a response conforming to the API contract, including a status (success, access_denied, error) and either the new UI view configuration or an error/denial message.5. Non-Functional Requirements (MVP Focus)Usability: Generated interfaces must be clear and usable. Access denied messages must be clear.Reliability: The core interaction loop must function reliably. Basic error handling for API errors and invalid configurations.Security: User authentication via OIDC standard. Task-based authorization on backend. HTTPS for API. Backend trusts user_id from Streamlit frontend (MVP limitation).Maintainability: Code structured logically (reusable View Classes in Streamlit, clear API contract via OpenAPI, decoupled Agent logic).6. Design & Technical SpecificationsFrontend Framework: Streamlit (Version >= 1.42.0 recommended).User Authentication: Streamlit's built-in OIDC support (st.login, st.logout, st.experimental_user). Configuration via secrets.toml.Agent Logic Server: Separate backend service (likely Python).Agent Memory Service: Separate service.Communication Protocol: Secure RESTful API over HTTPS between the Streamlit backend process and the Agent Logic Server. The API contract will be formally defined using the OpenAPI Specification (v3.x).Identity Propagation (MVP): The Streamlit backend process will extract the authenticated user's identifier (e.g., email from st.experimental_user) after successful OIDC login. This identifier will be included in the payload of API calls to the Agent Logic Server as the user_id. For the MVP, the Agent Logic Server will trust this identifier received from the Streamlit backend process over the secure internal connection. Cryptographic token validation on the Agent Logic server is deferred post-MVP. Note: This 'Backend Trust' approach (Alternative B1) has security limitations and should be reviewed and likely replaced with a token-based validation method (e.g., Alternative B2) before any production deployment.UI Definition: Object-Oriented Approach. Agent Logic server sends configuration data (defined by OpenAPI schema) describing which UI View Class (defined in Streamlit project) to instantiate and its parameters. Streamlit includes predefined Python View Classes (FormView, ChatView, etc.) inheriting from UIView. Streamlit script instantiates the class using the config and calls .render(). Configuration format V1.0 to be defined within the OpenAPI spec.Interaction Handling (Streamlit): Implementation will use a Hybrid Approach:st.form Prioritization: If the view config indicates a logical form structure suitable for st.form, the View Class's .render() method (or interpreting script logic) should use st.form() and st.form_submit_button(). Interaction detection relies on the submit button's return value.Explicit Key Iteration (Fallback/Default): For elements outside st.form blocks, use post-render logic iterating through keys from the view config, checking st.session_state, identifying action, collecting data, triggering API call, and resetting trigger state.State reset logic is mandatory in both scenarios.State Management (Streamlit): st.session_state stores the current UI view configuration, user info (st.experimental_user), temporary interaction data. Handles task_id from st.query_params. Prefer storing view configuration and re-instantiating view objects on rerun.State Management (Agent): Handled by Agent Logic Server, using Agent Memory Service. Task-specific state and permissions managed here.Asynchronous Operations: Handled by Agent Logic Server for MVP. Streamlit makes synchronous API calls, may use st.spinner.7. Release Criteria / Scope (MVP - Minimum Viable Product)Users can successfully log in via Google and Microsoft and log out.Ability to access the app via a URL containing a task_id.Correct handling of login flow when task_id is present (login first, check access via API).Agent can define, and Streamlit can instantiate/render, simple views (text, basic forms, basic chat, basic metrics).Core interaction loop functional using Hybrid Approach.Display of 'Access Denied' message if agent server denies access.Basic error messages for API failures / invalid view configs.Initial definition/implementation of base UIView and MVP view classes.API contract documented using OpenAPI Specification.8. Future Considerations (Out of Scope for MVP)Support for complex View Classes.Sophisticated layout options.Real-time communication (WebSockets).Comprehensive security review and hardening.Implementing robust token-based validation (e.g., Alternative B2) on the Agent Logic Server.Performance testing, optimization, scalability.Automated deployment pipelines (CI/CD).Agent-side async task feedback.Versioning/migration strategy for view configurations beyond V1.0.Admin interface.9. Open Issues / Questions (To be addressed)Formal definition of the V1.0 UI View Class configurations (JSON structure, parameters) within the OpenAPI schema.Formal definition of the base UIView class interface (__init__, .render()).Formal definition of the API contract using OpenAPI Specification v3.x (endpoints, request/response schemas, task_id, access denied responses).Decision on specific backend framework(s) for Agent Logic/Memory services.Detailed strategy for error handling and reporting.Serialization considerations for view objects.Refined strategy for associating input data keys with action keys within view configurations.Definition of the mechanism/data store for managing user_id to task_id permissions (Agent Logic/Memory responsibility).Review security implications of the 'Pass User Identifier + Backend Trust' model (Alternative B1) and plan for a more robust token-based validation strategy post-MVP.This PRD (v2.2) incorporates task handling, OpenAPI for the API contract, and the 'Pass Identifier' strategy for MVP identity propagation.